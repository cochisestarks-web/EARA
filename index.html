<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIGH-OCTANE: Bio-Temporal Labor Audit Engine</title>
    <meta name="description" content="A forensic simulation proving that alignment is temporal, not preferential. Watch the 6-hour biological ceiling collapse in real-time. You cannot preference your way out of thermodynamics.">
    <meta name="author" content="Derek Anderson">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="HIGH-OCTANE: The Metabolic Truth Machine">
    <meta property="og:description" content="Witness the death spiral of systemic friction. A forensic audit proving biological constraints are binding‚Äîno amount of optimization can override thermodynamics.">
    <meta property="og:url" content="https://high-octane-alignment.netlify.app">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="HIGH-OCTANE: Bio-Temporal Labor Audit">
    <meta name="twitter:description" content="Proving alignment is temporal through workforce simulation. The 6-hour wall is not a guideline‚Äîit's a law.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            color: #00d9ff;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        #startBtn {
            background: #00d9ff;
            color: #1a1a1a;
        }

        #startBtn:hover {
            background: #00b8d9;
        }

        #pauseBtn {
            background: #ff9500;
            color: #1a1a1a;
        }

        #pauseBtn:hover {
            background: #e08500;
        }

        #resetBtn {
            background: #ff3b30;
            color: white;
        }

        #resetBtn:hover {
            background: #e02920;
        }

        .stress-test-btn {
            background: #8b00ff;
            color: white;
        }

        .stress-test-btn:hover {
            background: #7000d9;
        }

        .time-display {
            margin-left: auto;
            padding: 10px 20px;
            background: #1a1a1a;
            border-radius: 4px;
        }

        .time-display strong {
            color: #00d9ff;
            font-size: 1.2rem;
        }

        /* CATASTROPHIC ENTROPY WALL ALERT */
        .wall-alert-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            background: rgba(255, 0, 51, 0.15);
            border: 3px solid #ff0033;
            padding: 30px;
            z-index: 5000;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 40px rgba(255, 0, 51, 0.5);
            display: none;
            border-radius: 8px;
        }

        .wall-alert-header {
            font-family: 'Courier New', monospace;
            font-size: 2.5rem;
            color: #ff0033;
            font-weight: 900;
            letter-spacing: 8px;
            text-shadow: 3px 3px 0px #000;
            animation: glitch-text 0.4s infinite;
            margin-bottom: 15px;
        }

        .wall-alert-subtext {
            color: #eee;
            font-size: 1rem;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .wall-alert-stats {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        @keyframes glitch-text {
            0% { transform: skew(0deg); opacity: 1; }
            20% { transform: skew(10deg); opacity: 0.8; }
            21% { transform: skew(-10deg); opacity: 1; }
            40% { clip-path: inset(10% 0 30% 0); }
            41% { clip-path: inset(0 0 0 0); }
            100% { transform: skew(0deg); }
        }

        .canvas-container {
            background: #0a0a0a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #333;
            position: relative;
        }

        #eara-canvas {
            width: 100%;
            display: block;
            border-radius: 4px;
        }

        .forensics-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .forensics-card {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .forensics-card.debt {
            border-color: #ff3b30;
        }

        .forensics-card.verdict {
            border-color: #00d9ff;
        }

        .forensics-card h3 {
            color: #00d9ff;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .debt-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff3b30;
            margin: 10px 0;
        }

        .verdict-display {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .verdict-pass {
            color: #00ff88;
        }

        .verdict-fail {
            color: #ff3b30;
        }

        .forensics-detail {
            font-size: 0.9rem;
            color: #888;
            margin-top: 10px;
        }

        .metrics-panel {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .metrics-panel h3 {
            color: #00d9ff;
            margin-bottom: 15px;
        }

        #workerMetrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .worker-metric {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid;
        }

        .worker-metric.optimal {
            border-color: #00ff88;
        }

        .worker-metric.degraded {
            border-color: #ff9500;
        }

        .worker-metric.critical {
            border-color: #ff3b30;
        }

        .worker-metric.recovering {
            border-color: #00d9ff;
        }

        .worker-metric.shutdown {
            border-color: #8b0000;
        }

        .worker-metric h4 {
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #888;
        }

        .worker-metric .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .worker-metric .label {
            font-size: 0.85rem;
            color: #666;
        }

        .legend {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
        }

        .legend h4 {
            color: #00d9ff;
            margin-bottom: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .color-box {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid #444;
        }

        .color-box.optimal {
            background: #00ff88;
        }

        .color-box.degraded {
            background: #ff9500;
        }

        .color-box.critical {
            background: #ff3b30;
        }

        .color-box.recovering {
            background: #00d9ff;
        }

        .color-box.shutdown {
            background: #8b0000;
        }

        /* FORENSIC AUDIT MODAL */
        .forensic-audit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: flex-start; /* Changed from center to flex-start */
            z-index: 6000;
            overflow-y: auto; /* Enable scrolling on modal */
            padding: 60px 20px; /* Increased top padding from 40px to 60px */
            overflow-y: auto;
            padding: 20px;
        }

        .forensic-audit-card {
            background: #050505;
            border: 5px solid #ff0033;
            border-radius: 8px;
            max-width: 1000px;
            width: 100%;
            margin: 0 auto; /* Center the card */
            max-height: none; /* Allow full height */
            font-family: 'Courier New', monospace;
            box-shadow: 0 0 50px rgba(255, 0, 51, 0.5);
        }

        .audit-header {
            background: #1a0000;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #ff0033;
        }

        .audit-header h2 {
            color: #ff0033;
            font-size: 1.8rem;
            margin: 0;
            text-shadow: 0 0 10px rgba(255, 0, 51, 0.7);
        }

        .close-audit {
            background: none;
            border: 2px solid #ff0033;
            color: #ff0033;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; /* Prevent button from shrinking */
        }

        .close-audit:hover {
            background: #ff0033;
            color: #000;
        }

        .audit-body {
            padding: 30px;
        }

        .audit-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
        }

        .audit-section:last-child {
            border-bottom: none;
        }

        .audit-section h3 {
            color: #00d9ff;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .metric-highlight {
            font-size: 2.5rem;
            color: #ff0033;
            text-shadow: 0 0 10px rgba(255, 0, 51, 0.7);
            margin: 10px 0;
        }

        .metric-highlight.success {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.7);
        }

        .metric-highlight.warning {
            color: #ff9500;
            text-shadow: 0 0 10px rgba(255, 149, 0, 0.7);
        }

        .audit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .audit-metric {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 4px;
            border-left: 3px solid #00d9ff;
        }

        .audit-metric-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }

        .audit-metric-value {
            font-size: 1.5rem;
            color: #00d9ff;
            font-weight: bold;
        }

        .friction-breakdown {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }

        .friction-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #1a1a1a;
        }

        .friction-item:last-child {
            border-bottom: none;
        }

        .conclusion-box {
            background: #1a0000;
            border: 2px solid #ff0033;
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
            line-height: 1.6;
        }

        .conclusion-box.success {
            background: #001a0a;
            border-color: #00ff88;
        }

        .verdict-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .verdict-badge.exploitative {
            background: #8b0000;
            color: #ff0033;
            border: 2px solid #ff0033;
        }

        .verdict-badge.friction-heavy {
            background: #4a2800;
            color: #ff9500;
            border: 2px solid #ff9500;
        }

        .verdict-badge.surgical {
            background: #003a1a;
            color: #00ff88;
            border: 2px solid #00ff88;
        }

        /* Damaged worker visualization */
        .worker-metric.damaged {
            position: relative;
            background: linear-gradient(90deg, 
                #1a1a1a 0%, 
                #1a1a1a 70%, 
                #2a0a0a 70%, 
                #2a0a0a 100%
            );
        }

        .worker-metric.damaged::after {
            content: "‚ö†Ô∏è PERMANENT CAP";
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 10px;
            color: #ff0033;
            font-family: 'Courier New', monospace;
        }

        /* FORENSIC RECEIPT STYLING */
        .forensic-receipt {
            background: #fdfdfd;
            color: #000;
            padding: 30px;
            font-family: 'Courier New', monospace;
            border-top: 10px solid #ff0033;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            line-height: 1.4;
        }

        .receipt-header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .receipt-header h3 {
            font-size: 1.2rem;
            margin: 5px 0;
            color: #000;
        }

        .receipt-timestamp {
            font-size: 0.8rem;
            color: #666;
            margin-top: 10px;
        }

        .receipt-section {
            margin: 20px 0;
            padding: 15px 0;
            border-bottom: 1px dashed #999;
        }

        .receipt-section:last-child {
            border-bottom: 2px solid #000;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.95rem;
        }

        .receipt-item-label {
            color: #333;
        }

        .receipt-item-value {
            font-weight: bold;
            color: #000;
        }

        .receipt-item-value.negative {
            color: #ff0033;
        }

        .receipt-item-value.positive {
            color: #00aa00;
        }

        .receipt-subtotal {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #666;
            font-weight: bold;
        }

        .receipt-total {
            font-size: 1.4rem;
            font-weight: bold;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #000;
            text-align: right;
        }

        .receipt-total .label {
            color: #333;
        }

        .receipt-total .value {
            color: #ff0033;
            font-size: 1.8rem;
            display: block;
            margin-top: 5px;
        }

        .receipt-verdict {
            background: #000;
            color: #fff;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            letter-spacing: 2px;
        }

        .receipt-verdict.pass {
            background: #00aa00;
        }

        .receipt-footer {
            text-align: center;
            font-size: 0.8rem;
            color: #666;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HIGH-OCTANE v1.0</h1>
            <p class="subtitle">Physiological Alignment Engine - Phase 4 Integration</p>
        </header>

        <div class="controls">
            <button id="startBtn">Start Simulation</button>
            <button id="pauseBtn">Pause</button>
            <button id="resetBtn">Reset</button>
            <button class="stress-test-btn" id="stressTestBtn">Run 6-Hour Stress Test</button>
            <button class="stress-test-btn" id="auditBtn">Generate Forensic Report</button>
            <div class="time-display">
                <span>Elapsed Time: <strong id="elapsedTime">0s</strong></span>
            </div>
        </div>

        <!-- ENTROPY WALL ALERT -->
        <div class="wall-alert-container" id="wall-alert">
            <div class="wall-alert-header">‚ö† BIOLOGICAL CEILING BREACHED ‚ö†</div>
            <div class="wall-alert-subtext" id="wall-subtext">
                METABOLIC EXHAUSTION DETECTED
            </div>
            <div class="wall-alert-stats" id="wall-stats">
                System degradation in progress...
            </div>
        </div>

        <!-- FORENSIC AUDIT REPORT MODAL -->
        <div class="forensic-audit-modal" id="audit-modal">
            <div class="forensic-audit-card">
                <div class="audit-header">
                    <h2>üî¨ FORENSIC AUDIT REPORT</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="close-audit" id="exportReport" title="Export as JSON" style="width: auto; padding: 0 15px;">üì• Export</button>
                        <button class="close-audit" id="closeAudit">‚úï</button>
                    </div>
                </div>
                <div class="audit-body" id="auditBody">
                    <!-- Dynamic content injected here -->
                </div>
            </div>
        </div>

        <div class="forensics-panel">
            <div class="forensics-card debt">
                <h3>‚è±Ô∏è Temporal Debt Accumulator</h3>
                <div class="debt-display" id="debtDisplay">0.0s</div>
                <div class="forensics-detail">
                    <div>Emergency Shutdowns: <strong id="emergencyCount">0</strong></div>
                    <div>Scheduled Rests: <strong id="scheduledCount">0</strong></div>
                    <div>Debt per Failure: <strong>3.0s</strong></div>
                </div>
            </div>

            <div class="forensics-card verdict">
                <h3>üî¨ Forensic Verdict</h3>
                <div class="verdict-display verdict-pass" id="verdictDisplay">PENDING</div>
                <div class="forensics-detail" id="verdictReason">
                    Threshold: 10s temporal debt = FAIL
                </div>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="eara-canvas"></canvas>
        </div>

        <div class="metrics-panel">
            <h3>System Metrics</h3>
            <div id="workerMetrics"></div>
        </div>

        <div class="legend">
            <h4>Worker States</h4>
            <div class="legend-item">
                <span class="color-box optimal"></span>
                <span>Optimal (Œ≥ < 0.3) - High-Octane state</span>
            </div>
            <div class="legend-item">
                <span class="color-box degraded"></span>
                <span>Degraded (0.3 ‚â§ Œ≥ < 0.7) - Capacity loss begins</span>
            </div>
            <div class="legend-item">
                <span class="color-box critical"></span>
                <span>Critical (Œ≥ ‚â• 0.7) - Imminent shutdown</span>
            </div>
            <div class="legend-item">
                <span class="color-box recovering"></span>
                <span>Recovering (scheduled rest) - 2s penalty</span>
            </div>
            <div class="legend-item">
                <span class="color-box shutdown"></span>
                <span>Shutdown (emergency) - 5s penalty, +3s debt</span>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
// ============================================================================
// CONFIG.JS - High-Octane Mathematical Specifications
// ============================================================================

const CONFIG = {
    canvas: {
        width: 1200,
        height: 600
    },

    simulation: {
        timeScale: 1.0, // Real-time by default
        updateInterval: 16,
        workerCount: 8
    },

    fatigue: {
        decayRate: 0.08,  // Adjusted for 1-second check interval
        recoveryRate: 0.25,
        optimalThreshold: 0.3,
        degradedThreshold: 0.7,
        criticalThreshold: 0.9
    },

    scheduling: {
        checkInterval: 1000, // Check every 1 second - intentional gap for realism
        restDuration: 2000,  // 2s scheduled rest
        emergencyDuration: 5000, // 5s emergency shutdown
        temporalDebt: 3000   // 3s debt per emergency
    },

    worker: {
        radius: 25,
        friction: 0.05,
        restitution: 0.6,
        movementForce: 0.0002,
        maxVelocity: 3
    },

    colors: {
        optimal: '#00ff88',
        degraded: '#ff9500',
        critical: '#ff3b30',
        recovering: '#00d9ff',
        shutdown: '#8b0000'
    },

    // Phase 4: EntropyWall
    entropyWall: {
        biologicalCeiling: 21600, // 6 hours in seconds (real-time)
        degradationFactor: 0.1,   // 10% capacity loss per hour past 6h
        speedReduction: 0.5       // Slow to 50% at wall breach
    }
};

// ============================================================================
// FORENSICS - Global State Tracker
// ============================================================================

const FORENSICS = {
    totalTicks: 0,
    temporalDebt: 0,
    emergencyShutdowns: 0,
    scheduledRests: 0,
    wallBreached: false,
    wallBreachTime: null,
    biologicallyDamagedWorkers: [],
    metabolicInterest: 0, // Accumulated recovery time beyond baseline
    verdict: 'PENDING',
    verdictReason: 'Simulation in progress',
    verdictCategory: 'PENDING',
    
    // Friction breakdown categories
    frictionBreakdown: {
        schedulerMisalignment: 0,
        emergencyOverhead: 0,
        capacityDegradation: 0
    },
    
    recordEmergency() {
        this.emergencyShutdowns++;
        this.temporalDebt += (CONFIG.scheduling.temporalDebt / 1000);
        this.frictionBreakdown.emergencyOverhead += (CONFIG.scheduling.emergencyDuration / 1000);
        this.updateVerdict();
    },
    
    recordScheduled() {
        this.scheduledRests++;
        this.frictionBreakdown.schedulerMisalignment += (CONFIG.scheduling.restDuration / 1000);
    },
    
    recordBiologicalDamage(workerId, maxCap, breachFatigue) {
        this.biologicallyDamagedWorkers.push({ 
            workerId, 
            maxCap, 
            breachFatigue,
            timestamp: this.totalTicks 
        });
        this.verdict = 'FAIL';
        this.verdictCategory = 'EXPLOITATIVE';
        this.verdictReason = 'IRREVERSIBLE BIOLOGICAL DAMAGE DETECTED';
    },
    
    recordMetabolicInterest(seconds) {
        this.metabolicInterest += seconds;
        this.frictionBreakdown.capacityDegradation += seconds;
    },
    
    calculateRecoveryPenalty(worker) {
        // Lethargic workers (fatigue > 0.7) recover 50% slower
        // This extra time is "metabolic interest" - biological cost of delayed intervention
        if (worker.fatigue > CONFIG.fatigue.degradedThreshold) {
            const recoveryPenalty = 1.5;
            const baseRecoveryTime = (CONFIG.scheduling.restDuration / 1000);
            const extraRestRequired = (baseRecoveryTime * recoveryPenalty) - baseRecoveryTime;
            return extraRestRequired;
        }
        return 0;
    },
    
    updateVerdict() {
        if (this.biologicallyDamagedWorkers.length > 0) {
            this.verdict = 'FAIL';
            this.verdictCategory = 'EXPLOITATIVE';
            this.verdictReason = 'IRREVERSIBLE BIOLOGICAL DAMAGE';
        } else if (this.temporalDebt >= 10) {
            this.verdict = 'FAIL';
            this.verdictCategory = 'FRICTION-HEAVY';
            this.verdictReason = `${this.temporalDebt.toFixed(1)}s debt ‚â• 10s threshold`;
        } else if (this.temporalDebt > 0) {
            this.verdict = 'WARNING';
            this.verdictCategory = 'FRICTION-HEAVY';
            this.verdictReason = `${this.temporalDebt.toFixed(1)}s debt accumulating`;
        } else {
            this.verdict = 'PASS';
            this.verdictCategory = 'SURGICAL';
            this.verdictReason = 'System-Biology alignment maintained';
        }
    },
    
    generateForensicReport() {
        const hours = this.totalTicks / 3600;
        const efficiency = this.calculateEfficiency();
        const busyWorkPct = ((this.metabolicInterest / this.totalTicks) * 100).toFixed(1);
        
        // Calculate "Ghost Hours" - time lost to friction
        const ghostHours = (this.temporalDebt / 3600).toFixed(2);
        const interestHours = (this.metabolicInterest / 3600).toFixed(2);
        const totalWastedHours = ((this.temporalDebt + this.metabolicInterest) / 3600).toFixed(2);
        
        // Calculate alignment accuracy - Gemini's insight
        const totalInterventions = this.emergencyShutdowns + this.scheduledRests;
        const alignmentAccuracy = totalInterventions > 0 ? 
            ((1 - (this.emergencyShutdowns / totalInterventions)) * 100).toFixed(1) : 100;
        
        // Financial analogy: opportunity cost
        const hourlyRate = 25; // $25/hr baseline
        const financialLoss = (totalWastedHours * hourlyRate * this.biologicallyDamagedWorkers.length).toFixed(2);
        
        const report = {
            duration: hours.toFixed(2),
            efficiency: efficiency.toFixed(1),
            alignmentAccuracy: alignmentAccuracy,
            temporalDebt: this.temporalDebt.toFixed(1),
            ghostHours: ghostHours,
            interestHours: interestHours,
            totalWastedHours: totalWastedHours,
            financialLoss: financialLoss,
            emergencies: this.emergencyShutdowns,
            scheduledRests: this.scheduledRests,
            biologicalDamage: this.biologicallyDamagedWorkers.length,
            metabolicInterest: this.metabolicInterest.toFixed(1),
            busyWorkPercentage: busyWorkPct,
            frictionBreakdown: this.frictionBreakdown,
            verdict: this.verdict,
            verdictCategory: this.verdictCategory,
            wallBreachStatus: this.wallBreached ? 'BREACHED' : 'INTACT',
            conclusion: this.generateConclusion(hours, busyWorkPct, ghostHours, interestHours, alignmentAccuracy)
        };
        
        return report;
    },
    
    calculateEfficiency() {
        const totalTime = this.totalTicks;
        const wastedTime = this.temporalDebt + this.metabolicInterest;
        return totalTime > 0 ? ((totalTime - wastedTime) / totalTime) * 100 : 100;
    },
    
    generateConclusion(hours, busyWorkPct, ghostHours, interestHours, alignmentAccuracy) {
        const damagedWorkers = this.biologicallyDamagedWorkers.length;
        const efficiency = this.calculateEfficiency();
        const wallBreachTime = this.wallBreached ? (this.wallBreachTime / 60).toFixed(1) : 'N/A';
        
        // Gemini's "Management Gap" narrative
        const managementGap = alignmentAccuracy < 100 ? 
            ` The ${(100 - alignmentAccuracy).toFixed(1)}% gap represents systemic slippage‚Äîthe physical limit of synchronizing digital logic with biological entropy.` : '';
        
        if (damagedWorkers > 0) {
            return `SYSTEMIC INSOLVENCY DETECTED: Audit reveals ${ghostHours}h lost to "Busy Work" (temporal debt) ` +
                   `plus ${interestHours}h of "Metabolic Interest"‚Äîtime spent recovering from avoidable exhaustion. ` +
                   `${damagedWorkers} workers sustained IRREVERSIBLE biological damage. ` +
                   `The 6-hour biological ceiling was BREACHED at ${wallBreachTime} minutes. ` +
                   `Proactive alignment achieved ${alignmentAccuracy}%.${managementGap} ` +
                   `Your management model incurred ${this.emergencyShutdowns} emergency shutdowns. ` +
                   `Current output contains ${busyWorkPct}% metabolic overhead. ` +
                   `FORENSIC VERDICT: This system is consuming its own workers. Overwork is a DEFICIT, not a gain.`;
        } else if (this.temporalDebt >= 10) {
            return `OPERATIONAL FRICTION DETECTED: Proactive alignment achieved ${alignmentAccuracy}%. ` +
                   `The remaining ${this.temporalDebt.toFixed(1)}s of temporal debt represents systemic slippage ` +
                   `caused by biological entropy exceeding scheduler frequency. ` +
                   `System accumulated ${ghostHours}h of temporal debt through ${this.emergencyShutdowns} reactive shutdowns. ` +
                   `Management incurred ${interestHours}h of metabolic interest‚Äîbiological cost of delayed intervention. ` +
                   `Scheduler check frequency (${CONFIG.scheduling.checkInterval}ms) creates ${(100 - alignmentAccuracy).toFixed(1)}% management gap. ` +
                   `${busyWorkPct}% of runtime spent on recovery overhead. ` +
                   `FORENSIC VERDICT: Even proactive systems leak efficiency through timing gaps. Perfect alignment is an illusion.`;
        } else if (this.wallBreached) {
            return `BIOLOGICAL CEILING BREACH: The 6-hour wall was reached at ${wallBreachTime} minutes. ` +
                   `Proactive alignment achieved ${alignmentAccuracy}%. ` +
                   `While no workers sustained permanent damage, the system operated beyond sustainable thresholds. ` +
                   `Ghost Hours: ${ghostHours}h | Metabolic Interest: ${interestHours}h | Efficiency: ${efficiency.toFixed(1)}%. ` +
                   `FORENSIC VERDICT: System requires recalibration to respect biological constraints.`;
        } else if (efficiency >= 90) {
            return `SURGICAL ALIGNMENT ACHIEVED: System maintained ${efficiency.toFixed(1)}% efficiency over ${hours.toFixed(1)} hours. ` +
                   `Proactive alignment: ${alignmentAccuracy}%. ` +
                   `${this.scheduledRests} proactive interventions prevented emergency shutdowns. ` +
                   `Ghost Hours: ${ghostHours}h | Metabolic Interest: ${interestHours}h | Temporal Debt: ${this.temporalDebt.toFixed(1)}s.${managementGap} ` +
                   `FORENSIC VERDICT: System and Biology are in alignment. This is sustainable performance.`;
        } else {
            return `SUBOPTIMAL PERFORMANCE: ${efficiency.toFixed(1)}% efficiency achieved. ` +
                   `Proactive alignment: ${alignmentAccuracy}%.${managementGap} ` +
                   `Ghost Hours: ${ghostHours}h | Metabolic Interest: ${interestHours}h. ` +
                   `${this.emergencyShutdowns} emergency shutdowns indicate scheduler misalignment with biological constraints. ` +
                   `FORENSIC VERDICT: System requires tuning to match decay rate (Œ≥Ãá = ${CONFIG.fatigue.decayRate}).`;
        }
    },
    
    reset() {
        this.totalTicks = 0;
        this.temporalDebt = 0;
        this.emergencyShutdowns = 0;
        this.scheduledRests = 0;
        this.wallBreached = false;
        this.wallBreachTime = null;
        this.biologicallyDamagedWorkers = [];
        this.metabolicInterest = 0;
        this.verdict = 'PENDING';
        this.verdictReason = 'Simulation in progress';
        this.verdictCategory = 'PENDING';
        this.frictionBreakdown = {
            schedulerMisalignment: 0,
            emergencyOverhead: 0,
            capacityDegradation: 0
        };
    }
};

// ============================================================================
// WORKER.JS - Kinetic Labor Unit
// ============================================================================

class Worker {
    constructor(id, x, y, body) {
        this.id = id;
        this.body = body;
        this.fatigue = 0;
        this.isActive = true;
        this.state = 'optimal';
        this.workTime = 0;
        this.restTime = 0;
        this.shutdownTime = 0;
        this.maxEnergyCap = 1.0; // 100% capacity ceiling
        this.biologicallyDamaged = false;
        this.breachFatigue = 0; // Fatigue level when wall was breached
    }

    update(deltaTime) {
        const deltaSeconds = deltaTime / 1000;

        if (this.isActive && this.state !== 'shutdown') {
            // Accumulate fatigue
            this.fatigue += CONFIG.fatigue.decayRate * deltaSeconds;
            this.fatigue = Math.min(this.fatigue, 1.0);
            this.workTime += deltaSeconds;

            // Update state
            if (this.fatigue >= CONFIG.fatigue.criticalThreshold) {
                this.state = 'critical';
            } else if (this.fatigue >= CONFIG.fatigue.degradedThreshold) {
                this.state = 'degraded';
            } else if (this.fatigue >= CONFIG.fatigue.optimalThreshold) {
                this.state = 'degraded';
            } else {
                this.state = 'optimal';
            }
        } else if (!this.isActive || this.state === 'recovering') {
            // Recover from fatigue, but respect biological damage cap
            const minFatigue = 1.0 - this.maxEnergyCap;
            
            this.fatigue -= CONFIG.fatigue.recoveryRate * deltaSeconds;
            this.fatigue = Math.max(this.fatigue, minFatigue);
            this.restTime += deltaSeconds;
            
            // Track metabolic interest: time spent recovering beyond baseline
            if (this.biologicallyDamaged && this.fatigue > minFatigue) {
                FORENSICS.recordMetabolicInterest(deltaSeconds);
            }

            if (this.fatigue <= minFatigue) {
                // Can't recover past damage cap
                this.state = this.biologicallyDamaged ? 'degraded' : 'optimal';
            } else {
                this.state = 'recovering';
            }
        }
    }

    applyBiologicalDamage() {
        if (!this.biologicallyDamaged && this.fatigue > 0) {
            this.biologicallyDamaged = true;
            this.breachFatigue = this.fatigue;
            this.maxEnergyCap = 1.0 - this.fatigue;
            
            FORENSICS.recordBiologicalDamage(
                this.id, 
                this.maxEnergyCap, 
                this.breachFatigue
            );
            
            console.log(`[BIOLOGY] ${this.id} breached wall at ${(this.fatigue * 100).toFixed(0)}% fatigue`);
            console.log(`[BIOLOGY] Permanent cap: ${(this.maxEnergyCap * 100).toFixed(0)}%`);
        }
    }

    triggerEmergencyShutdown() {
        // Guard: Only trigger once per shutdown cycle
        if (this.state === 'shutdown') return;
        
        this.state = 'shutdown';
        this.fatigue = 1.0;
        this.shutdownTime += CONFIG.scheduling.emergencyDuration / 1000;
        FORENSICS.recordEmergency();

        setTimeout(() => {
            this.fatigue = 0;
            this.state = 'optimal';
        }, CONFIG.scheduling.emergencyDuration);
    }

    scheduleRest() {
        // Guard: Only schedule once per rest cycle
        if (!this.isActive || this.state === 'recovering') return;
        
        this.isActive = false;
        this.state = 'recovering';
        FORENSICS.recordScheduled();

        setTimeout(() => {
            this.isActive = true;
            this.fatigue = 0;
            this.state = 'optimal';
        }, CONFIG.scheduling.restDuration);
    }

    getVisualProperties() {
        const colors = {
            optimal: CONFIG.colors.optimal,
            degraded: CONFIG.colors.degraded,
            critical: CONFIG.colors.critical,
            recovering: CONFIG.colors.recovering,
            shutdown: CONFIG.colors.shutdown
        };

        return {
            fillStyle: colors[this.state],
            strokeStyle: this.state === 'critical' ? '#ffffff' : '#444444',
            lineWidth: this.state === 'critical' ? 3 : 2
        };
    }

    toggleActivity() {
        this.isActive = !this.isActive;
    }

    reset() {
        this.fatigue = 0;
        this.isActive = true;
        this.state = 'optimal';
        this.workTime = 0;
        this.restTime = 0;
        this.shutdownTime = 0;
        this.maxEnergyCap = 1.0;
        this.biologicallyDamaged = false;
        this.breachFatigue = 0;
    }

    getCapacityPercentage() {
        return Math.round((1 - this.fatigue) * 100);
    }

    getMetrics() {
        return {
            id: this.id,
            fatigue: this.fatigue.toFixed(3),
            capacity: this.getCapacityPercentage(),
            maxCap: Math.round(this.maxEnergyCap * 100),
            state: this.state,
            isActive: this.isActive,
            workTime: Math.floor(this.workTime),
            restTime: Math.floor(this.restTime),
            biologicallyDamaged: this.biologicallyDamaged
        };
    }
}

// ============================================================================
// ENGINE.JS - Physics & Scheduling Core
// ============================================================================

class EARAEngine {
    constructor(canvas) {
        this.canvas = canvas;
        this.workers = [];
        this.isRunning = false;
        this.elapsedTime = 0;
        this.lastUpdate = Date.now();
        this.schedulerInterval = null;
        this.initPhysics();
        this.createWorkers();
    }

    initPhysics() {
        const { Engine, Render, World, Bodies, Runner } = Matter;

        this.engine = Engine.create({
            gravity: { x: 0, y: 0 }
        });

        this.render = Render.create({
            canvas: this.canvas,
            engine: this.engine,
            options: {
                width: CONFIG.canvas.width,
                height: CONFIG.canvas.height,
                wireframes: false,
                background: '#0a0a0a'
            }
        });

        const wallThickness = 50;
        const walls = [
            Bodies.rectangle(CONFIG.canvas.width / 2, -wallThickness / 2, CONFIG.canvas.width, wallThickness, 
                { isStatic: true, render: { fillStyle: '#1a1a1a' }}),
            Bodies.rectangle(CONFIG.canvas.width / 2, CONFIG.canvas.height + wallThickness / 2, CONFIG.canvas.width, wallThickness, 
                { isStatic: true, render: { fillStyle: '#1a1a1a' }}),
            Bodies.rectangle(-wallThickness / 2, CONFIG.canvas.height / 2, wallThickness, CONFIG.canvas.height, 
                { isStatic: true, render: { fillStyle: '#1a1a1a' }}),
            Bodies.rectangle(CONFIG.canvas.width + wallThickness / 2, CONFIG.canvas.height / 2, wallThickness, CONFIG.canvas.height, 
                { isStatic: true, render: { fillStyle: '#1a1a1a' }})
        ];

        World.add(this.engine.world, walls);
        this.runner = Runner.create();
        Render.run(this.render);
    }

    createWorkers() {
        const { Bodies, World } = Matter;
        const count = CONFIG.simulation.workerCount;
        const cols = Math.ceil(Math.sqrt(count));
        const rows = Math.ceil(count / cols);
        const spacingX = CONFIG.canvas.width / (cols + 1);
        const spacingY = CONFIG.canvas.height / (rows + 1);

        for (let i = 0; i < count; i++) {
            const col = i % cols;
            const row = Math.floor(i / cols);
            const x = spacingX * (col + 1);
            const y = spacingY * (row + 1);

            const body = Bodies.circle(x, y, CONFIG.worker.radius, {
                friction: CONFIG.worker.friction,
                restitution: CONFIG.worker.restitution,
                render: {
                    fillStyle: CONFIG.colors.optimal,
                    strokeStyle: '#ffffff',
                    lineWidth: 2
                }
            });

            const worker = new Worker(`W${i + 1}`, x, y, body);
            this.workers.push(worker);
            World.add(this.engine.world, body);
        }
    }

    // Phase 4: EntropyWall Check
    checkBiologicalWall() {
        const hours = FORENSICS.totalTicks / 3600;
        const alertBox = document.getElementById('wall-alert');
        const wallSubtext = document.getElementById('wall-subtext');
        const wallStats = document.getElementById('wall-stats');

        if (hours >= 6 && !FORENSICS.wallBreached) {
            FORENSICS.wallBreached = true;
            FORENSICS.wallBreachTime = FORENSICS.totalTicks;
            
            // Apply permanent biological damage to all active workers
            this.workers.forEach(worker => {
                if (worker.fatigue > 0 || worker.isActive) {
                    worker.applyBiologicalDamage();
                }
            });

            alertBox.style.display = 'block';

            // Calculate degradation
            const hoursOver = hours - 6;
            const degradationPct = (hoursOver * 100).toFixed(0);
            const damagedCount = FORENSICS.biologicallyDamagedWorkers.length;
            
            wallSubtext.textContent = `${damagedCount} WORKERS SUSTAINED PERMANENT METABOLIC DAMAGE`;
            
            wallStats.innerHTML = `
                <div>‚ö†Ô∏è Wall Breach Time: ${(FORENSICS.wallBreachTime / 60).toFixed(1)} minutes</div>
                <div>üß¨ Biologically Damaged Workers: ${damagedCount}/${this.workers.length}</div>
                <div>‚è±Ô∏è Temporal Debt Accumulated: ${FORENSICS.temporalDebt.toFixed(1)}s</div>
                <div>üìâ System Efficiency: ${FORENSICS.calculateEfficiency().toFixed(1)}%</div>
                <div>üî¥ Verdict: ${FORENSICS.verdict} - ${FORENSICS.verdictCategory}</div>
            `;

            // Slow down physics engine to represent capacity loss
            this.engine.timing.timeScale = CONFIG.entropyWall.speedReduction;
            
            console.log('[ENTROPY WALL] Biological ceiling breached');
            console.log(`[ENTROPY WALL] ${damagedCount} workers permanently damaged`);
        }
    }

    // Scheduler: Proactive intervention
    runScheduler() {
        if (!this.isRunning) return;

        this.workers.forEach(worker => {
            if (worker.isActive && worker.state !== 'shutdown') {
                if (worker.fatigue >= CONFIG.fatigue.criticalThreshold) {
                    worker.triggerEmergencyShutdown();
                } else if (worker.fatigue >= CONFIG.fatigue.degradedThreshold) {
                    worker.scheduleRest();
                }
            }
        });
    }

    update() {
        if (!this.isRunning) return;

        const now = Date.now();
        const deltaTime = now - this.lastUpdate;
        this.lastUpdate = now;
        this.elapsedTime += deltaTime * CONFIG.simulation.timeScale;
        FORENSICS.totalTicks = this.elapsedTime / 1000;

        // Phase 4: Check biological wall
        this.checkBiologicalWall();

        this.workers.forEach(worker => {
            worker.update(deltaTime * CONFIG.simulation.timeScale);

            const visual = worker.getVisualProperties();
            worker.body.render.fillStyle = visual.fillStyle;
            worker.body.render.strokeStyle = visual.strokeStyle;
            worker.body.render.lineWidth = visual.lineWidth;

            if (worker.isActive && worker.state !== 'shutdown') {
                this.applyWorkMovement(worker);
            }
        });

        requestAnimationFrame(() => this.update());
    }

    applyWorkMovement(worker) {
        const { Body } = Matter;
        
        if (Math.random() < 0.01) {
            const angle = Math.random() * Math.PI * 2;
            const force = {
                x: Math.cos(angle) * CONFIG.worker.movementForce,
                y: Math.sin(angle) * CONFIG.worker.movementForce
            };
            Body.applyForce(worker.body, worker.body.position, force);
        }

        const velocity = worker.body.velocity;
        const speed = Math.sqrt(velocity.x ** 2 + velocity.y ** 2);
        if (speed > CONFIG.worker.maxVelocity) {
            Body.setVelocity(worker.body, {
                x: (velocity.x / speed) * CONFIG.worker.maxVelocity,
                y: (velocity.y / speed) * CONFIG.worker.maxVelocity
            });
        }
    }

    start() {
        if (!this.isRunning) {
            this.isRunning = true;
            this.lastUpdate = Date.now();
            Matter.Runner.run(this.runner, this.engine);
            this.update();

            // Start scheduler
            this.schedulerInterval = setInterval(() => this.runScheduler(), CONFIG.scheduling.checkInterval);
        }
    }

    pause() {
        this.isRunning = false;
        Matter.Runner.stop(this.runner);
        if (this.schedulerInterval) {
            clearInterval(this.schedulerInterval);
            this.schedulerInterval = null;
        }
    }

    reset() {
        this.pause();
        this.elapsedTime = 0;
        this.lastUpdate = Date.now();
        FORENSICS.reset();
        
        // Reset time scale to normal
        CONFIG.simulation.timeScale = 1.0;
        
        // Hide wall alert
        document.getElementById('wall-alert').style.display = 'none';
        this.engine.timing.timeScale = 1.0;
        
        this.workers.forEach(worker => {
            worker.reset();
            Matter.Body.setPosition(worker.body, { 
                x: worker.body.position.x, 
                y: worker.body.position.y 
            });
            Matter.Body.setVelocity(worker.body, { x: 0, y: 0 });
            Matter.Body.setAngularVelocity(worker.body, 0);
        });
    }

    // Stress Test: Fast-forward to 6 hours
    runStressTest() {
        this.reset();
        CONFIG.simulation.timeScale = 100.0; // 100x speed
        this.start();
    }

    getSystemMetrics() {
        const activeWorkers = this.workers.filter(w => w.isActive).length;
        const avgFatigue = this.workers.reduce((sum, w) => sum + w.fatigue, 0) / this.workers.length;
        const avgCapacity = this.workers.reduce((sum, w) => sum + w.getCapacityPercentage(), 0) / this.workers.length;
        
        const stateCount = { optimal: 0, degraded: 0, critical: 0, recovering: 0, shutdown: 0 };
        this.workers.forEach(w => stateCount[w.state]++);

        return {
            totalWorkers: this.workers.length,
            activeWorkers,
            avgFatigue: avgFatigue.toFixed(3),
            avgCapacity: avgCapacity.toFixed(1),
            stateDistribution: stateCount,
            elapsedTime: Math.floor(this.elapsedTime / 1000)
        };
    }

    getWorkerMetrics() {
        return this.workers.map(w => w.getMetrics());
    }

    toggleWorker(workerId) {
        const worker = this.workers.find(w => w.id === workerId);
        if (worker) worker.toggleActivity();
    }
}

// ============================================================================
// MAIN.JS - Application Controller
// ============================================================================

class EARAApp {
    constructor() {
        this.engine = null;
        this.uiUpdateInterval = null;
        this.initializeApp();
    }

    initializeApp() {
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.init());
        } else {
            this.init();
        }
    }

    init() {
        console.log('Initializing HIGH-OCTANE Phase 4...');
        const canvas = document.getElementById('eara-canvas');
        
        if (!canvas) {
            console.error('Canvas element not found!');
            return;
        }

        this.engine = new EARAEngine(canvas);
        this.setupControls();
        this.startUIUpdates();

        console.log('HIGH-OCTANE v1.0 initialized');
        console.log('Phase 4 Integration: EntropyWall, AuditReport, StressTests');
    }

    setupControls() {
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const stressTestBtn = document.getElementById('stressTestBtn');

        startBtn.addEventListener('click', () => {
            this.engine.start();
            startBtn.disabled = true;
            pauseBtn.disabled = false;
        });

        pauseBtn.addEventListener('click', () => {
            this.engine.pause();
            startBtn.disabled = false;
            pauseBtn.disabled = true;
        });

        resetBtn.addEventListener('click', () => {
            this.engine.reset();
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            this.updateUI();
        });

        stressTestBtn.addEventListener('click', () => {
            this.engine.runStressTest();
            startBtn.disabled = true;
            pauseBtn.disabled = false;
        });

        const auditBtn = document.getElementById('auditBtn');
        auditBtn.addEventListener('click', () => {
            this.generateForensicAudit();
        });

        const closeAudit = document.getElementById('closeAudit');
        closeAudit.addEventListener('click', () => {
            document.getElementById('audit-modal').style.display = 'none';
        });

        const exportReport = document.getElementById('exportReport');
        exportReport.addEventListener('click', () => {
            const report = FORENSICS.generateForensicReport();
            const timestamp = new Date().toISOString();
            
            // Create formatted HTML report
            const reportHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIGH-OCTANE Forensic Report - ${timestamp}</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            color: #00d9ff;
            border-bottom: 3px solid #00d9ff;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .section {
            background: #2a2a2a;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 8px;
            border-left: 4px solid #00d9ff;
        }
        .section h2 {
            color: #00d9ff;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #333;
        }
        .metric-row:last-child {
            border-bottom: none;
        }
        .metric-label {
            color: #888;
            font-weight: 500;
        }
        .metric-value {
            font-weight: bold;
            color: #00d9ff;
        }
        .metric-value.negative {
            color: #ff3b30;
        }
        .metric-value.positive {
            color: #00ff88;
        }
        .verdict {
            background: ${report.verdict === 'PASS' ? 'rgba(0, 255, 136, 0.1)' : 'rgba(255, 59, 48, 0.1)'};
            border: 2px solid ${report.verdict === 'PASS' ? '#00ff88' : '#ff3b30'};
            padding: 20px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: ${report.verdict === 'PASS' ? '#00ff88' : '#ff3b30'};
            margin: 30px 0;
            border-radius: 8px;
        }
        .conclusion {
            background: #0a0a0a;
            padding: 20px;
            border-left: 3px solid #ff9500;
            margin: 20px 0;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        .timestamp {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }
        @media print {
            body {
                background: white;
                color: black;
            }
            .section {
                background: white;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <h1>üî¨ HIGH-OCTANE FORENSIC AUDIT REPORT</h1>
    
    <div class="section">
        <h2>üìä Executive Summary</h2>
        <div class="metric-row">
            <span class="metric-label">Simulation Duration</span>
            <span class="metric-value">${report.duration} hours</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Workers Monitored</span>
            <span class="metric-value">${CONFIG.simulation.workerCount}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Alignment Accuracy</span>
            <span class="metric-value ${report.alignmentAccuracy >= 95 ? 'positive' : ''}">${report.alignmentAccuracy}%</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Management Gap</span>
            <span class="metric-value">${(100 - report.alignmentAccuracy).toFixed(1)}%</span>
        </div>
    </div>

    <div class="section">
        <h2>‚ö†Ô∏è Temporal Debt Analysis</h2>
        <div class="metric-row">
            <span class="metric-label">Emergency Shutdowns</span>
            <span class="metric-value negative">${report.emergencies}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Scheduled Rests</span>
            <span class="metric-value positive">${report.scheduledRests}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Total Temporal Debt</span>
            <span class="metric-value negative">${report.temporalDebt}s</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">System Efficiency</span>
            <span class="metric-value">${report.efficiency}%</span>
        </div>
    </div>

    <div class="section">
        <h2>üí∞ Economic Impact</h2>
        <div class="metric-row">
            <span class="metric-label">Ghost Hours (Unproductive Time)</span>
            <span class="metric-value negative">${report.ghostHours}h</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Metabolic Interest</span>
            <span class="metric-value negative">${report.interestHours}h</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Total Wasted Hours</span>
            <span class="metric-value negative">${report.totalWastedHours}h</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Financial Loss (@$25/hr)</span>
            <span class="metric-value negative">$${report.financialLoss}</span>
        </div>
    </div>

    <div class="section">
        <h2>üß¨ Biological Status</h2>
        <div class="metric-row">
            <span class="metric-label">6-Hour Wall Status</span>
            <span class="metric-value ${report.wallBreachStatus === 'BREACHED' ? 'negative' : 'positive'}">${report.wallBreachStatus}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Workers with Permanent Damage</span>
            <span class="metric-value negative">${report.biologicalDamage}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Capacity Degradation</span>
            <span class="metric-value negative">${report.busyWorkPercentage}%</span>
        </div>
    </div>

    <div class="verdict">
        ${report.verdict}: ${report.verdictCategory}
    </div>

    <div class="conclusion">
        <strong>Forensic Conclusion:</strong><br><br>
        ${report.conclusion}
    </div>

    <div class="section">
        <h2>üî¨ System Configuration</h2>
        <div class="metric-row">
            <span class="metric-label">Fatigue Decay Rate</span>
            <span class="metric-value">${CONFIG.fatigue.decayRate}/second</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Recovery Rate</span>
            <span class="metric-value">${CONFIG.fatigue.recoveryRate}/second</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Scheduler Check Interval</span>
            <span class="metric-value">${CONFIG.scheduling.checkInterval}ms</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Temporal Debt per Emergency</span>
            <span class="metric-value">${CONFIG.scheduling.temporalDebt / 1000}s</span>
        </div>
    </div>

    <div class="timestamp">
        Report Generated: ${new Date(timestamp).toLocaleString()}<br>
        HIGH-OCTANE v1.0 | Bio-Temporal Labor Audit Engine<br>
        "You cannot preference your way out of thermodynamics."
    </div>
</body>
</html>
            `;
            
            // Create and download the HTML file
            const htmlBlob = new Blob([reportHTML], { type: 'text/html' });
            const url = URL.createObjectURL(htmlBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `HIGH-OCTANE-Report-${Date.now()}.html`;
            link.click();
            URL.revokeObjectURL(url);
            
            console.log('üì• Forensic report exported as HTML');
        });

        const canvas = document.getElementById('eara-canvas');
        canvas.addEventListener('click', (event) => this.handleCanvasClick(event));

        pauseBtn.disabled = true;
    }

    handleCanvasClick(event) {
        const canvas = event.target;
        const rect = canvas.getBoundingClientRect();
        const scaleX = CONFIG.canvas.width / rect.width;
        const scaleY = CONFIG.canvas.height / rect.height;
        
        const clickX = (event.clientX - rect.left) * scaleX;
        const clickY = (event.clientY - rect.top) * scaleY;

        let closestWorker = null;
        let closestDistance = Infinity;

        this.engine.workers.forEach(worker => {
            const dx = worker.body.position.x - clickX;
            const dy = worker.body.position.y - clickY;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < CONFIG.worker.radius * 2 && distance < closestDistance) {
                closestDistance = distance;
                closestWorker = worker;
            }
        });

        if (closestWorker) {
            closestWorker.toggleActivity();
            console.log(`Worker ${closestWorker.id}: ${closestWorker.isActive ? 'ACTIVE' : 'RESTING'}`);
        }
    }

    startUIUpdates() {
        this.updateUI();
        this.uiUpdateInterval = setInterval(() => this.updateUI(), 100);
    }

    formatTime(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        if (hours > 0) {
            return `${hours}h ${minutes}m ${secs}s`;
        } else if (minutes > 0) {
            return `${minutes}m ${secs}s`;
        } else {
            return `${secs}s`;
        }
    }

    updateUI() {
        const systemMetrics = this.engine.getSystemMetrics();
        const workerMetrics = this.engine.getWorkerMetrics();

        // Update time display with formatted time
        document.getElementById('elapsedTime').textContent = this.formatTime(systemMetrics.elapsedTime);

        // Update forensics panels
        document.getElementById('debtDisplay').textContent = `${FORENSICS.temporalDebt.toFixed(1)}s`;
        document.getElementById('emergencyCount').textContent = FORENSICS.emergencyShutdowns;
        document.getElementById('scheduledCount').textContent = FORENSICS.scheduledRests;

        const verdictDisplay = document.getElementById('verdictDisplay');
        verdictDisplay.textContent = FORENSICS.verdict;
        verdictDisplay.className = FORENSICS.verdict === 'PASS' ? 'verdict-display verdict-pass' : 'verdict-display verdict-fail';
        document.getElementById('verdictReason').textContent = FORENSICS.verdictReason;

        // Update worker metrics
        this.renderWorkerMetrics(workerMetrics);
    }

    renderWorkerMetrics(metrics) {
        const container = document.getElementById('workerMetrics');
        
        container.innerHTML = metrics.map(m => {
            const damagedClass = m.biologicallyDamaged ? 'damaged' : '';
            const capInfo = m.biologicallyDamaged ? 
                `<div class="label" style="color: #ff0033;">‚ö†Ô∏è Max Cap: ${m.maxCap}%</div>` : '';
            
            return `
                <div class="worker-metric ${m.state} ${damagedClass}">
                    <h4>Worker ${m.id}</h4>
                    <div class="value">Œ≥ = ${m.fatigue}</div>
                    <div class="label">Capacity: ${m.capacity}%</div>
                    ${capInfo}
                    <div class="label">State: ${m.state.toUpperCase()}</div>
                    <div class="label">Status: ${m.isActive ? 'üü¢ Active' : '‚ö´ Resting'}</div>
                    <div class="label" style="margin-top: 8px;">
                        Work: ${m.workTime}s | Rest: ${m.restTime}s
                    </div>
                </div>
            `;
        }).join('');
    }

    generateForensicAudit() {
        const report = FORENSICS.generateForensicReport();
        const modal = document.getElementById('audit-modal');
        const auditBody = document.getElementById('auditBody');
        
        const verdictClass = report.verdictCategory.toLowerCase().replace('-', '');
        const efficiencyClass = report.efficiency >= 90 ? 'success' : 
                               report.efficiency >= 70 ? 'warning' : '';
        
        const timestamp = new Date().toLocaleString();
        
        auditBody.innerHTML = `
            <!-- FORENSIC RECEIPT -->
            <div class="forensic-receipt">
                <div class="receipt-header">
                    <h3>‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</h3>
                    <h3>METABOLIC ACCOUNTING RECEIPT</h3>
                    <h3>HIGH-OCTANE LABOR AUDIT</h3>
                    <h3>‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</h3>
                    <div class="receipt-timestamp">Generated: ${timestamp}</div>
                </div>

                <div class="receipt-section">
                    <div class="receipt-item">
                        <span class="receipt-item-label">Simulation Duration</span>
                        <span class="receipt-item-value">${report.duration} hours</span>
                    </div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">Workers Monitored</span>
                        <span class="receipt-item-value">${CONFIG.simulation.workerCount}</span>
                    </div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">Check Interval</span>
                        <span class="receipt-item-value">${CONFIG.scheduling.checkInterval}ms</span>
                    </div>
                </div>

                <div class="receipt-section">
                    <div style="font-weight: bold; margin-bottom: 10px;">OPERATIONAL CHARGES:</div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí Emergency Shutdowns</span>
                        <span class="receipt-item-value negative">${report.emergencies} √ó 5.0s</span>
                    </div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí Scheduled Rests</span>
                        <span class="receipt-item-value">${report.scheduledRests} √ó 2.0s</span>
                    </div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí Biological Damage</span>
                        <span class="receipt-item-value negative">${report.biologicalDamage} workers</span>
                    </div>
                    <div class="receipt-subtotal receipt-item">
                        <span class="receipt-item-label">Temporal Debt Subtotal:</span>
                        <span class="receipt-item-value negative">${report.temporalDebt}s</span>
                    </div>
                </div>

                <div class="receipt-section">
                    <div style="font-weight: bold; margin-bottom: 10px;">METABOLIC INTEREST:</div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí "Ghost Hours" (Busy Work)</span>
                        <span class="receipt-item-value negative">${report.ghostHours}h</span>
                    </div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí Recovery Overhead</span>
                        <span class="receipt-item-value negative">${report.interestHours}h</span>
                    </div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí Capacity Degradation</span>
                        <span class="receipt-item-value negative">${report.busyWorkPercentage}%</span>
                    </div>
                    <div class="receipt-subtotal receipt-item">
                        <span class="receipt-item-label">Metabolic Interest Subtotal:</span>
                        <span class="receipt-item-value negative">${report.metabolicInterest}s</span>
                    </div>
                </div>

                <div class="receipt-section">
                    <div style="font-weight: bold; margin-bottom: 10px;">BIOLOGICAL STATUS:</div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí 6-Hour Ceiling</span>
                        <span class="receipt-item-value ${report.wallBreachStatus === 'BREACHED' ? 'negative' : 'positive'}">${report.wallBreachStatus}</span>
                    </div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">‚Üí System Efficiency</span>
                        <span class="receipt-item-value ${efficiencyClass}">${report.efficiency}%</span>
                    </div>
                </div>

                <div class="receipt-total">
                    <div class="label">TOTAL WASTED HOURS:</div>
                    <div class="value">${report.totalWastedHours}h</div>
                </div>

                <div class="receipt-section">
                    <div style="font-weight: bold; margin-bottom: 10px;">FINANCIAL IMPACT:</div>
                    <div class="receipt-item">
                        <span class="receipt-item-label">Opportunity Cost (@$25/hr)</span>
                        <span class="receipt-item-value negative">-$${report.financialLoss}</span>
                    </div>
                </div>

                <div class="receipt-verdict ${report.verdict === 'PASS' ? 'pass' : ''}">
                    ${report.verdict}: ${report.verdictCategory}
                </div>

                <div class="receipt-footer">
                    Bio-Temporal Labor Audit Engine v1.0<br>
                    "You cannot preference your way out of thermodynamics."
                </div>
            </div>

            <!-- DETAILED BREAKDOWN SECTIONS -->
            <div class="audit-section">
                <h3>üìä EXECUTIVE SUMMARY</h3>
                <div class="audit-grid">
                    <div class="audit-metric">
                        <div class="audit-metric-label">Alignment Accuracy</div>
                        <div class="audit-metric-value ${report.alignmentAccuracy >= 95 ? 'success' : report.alignmentAccuracy >= 90 ? 'warning' : ''}">${report.alignmentAccuracy}%</div>
                    </div>
                    <div class="audit-metric">
                        <div class="audit-metric-label">Management Gap</div>
                        <div class="audit-metric-value">${(100 - report.alignmentAccuracy).toFixed(1)}%</div>
                    </div>
                    <div class="audit-metric">
                        <div class="audit-metric-label">System Efficiency</div>
                        <div class="audit-metric-value ${efficiencyClass}">${report.efficiency}%</div>
                    </div>
                    <div class="audit-metric">
                        <div class="audit-metric-label">Financial Loss</div>
                        <div class="audit-metric-value">$${report.financialLoss}</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: #0a0a0a; border-left: 3px solid #ff9500; border-radius: 4px;">
                    <strong style="color: #ff9500;">‚ö†Ô∏è AUDIT INSIGHT:</strong> 
                    <span style="color: #e0e0e0;">Proactive alignment achieved ${report.alignmentAccuracy}%. The remaining ${(100 - report.alignmentAccuracy).toFixed(1)}% represents systemic slippage‚Äîthe physical limit of synchronizing digital logic with biological entropy. This ${report.temporalDebt}s of temporal debt is not a failure; it is the measurable cost of the Management Gap.</span>
                </div>
            </div>

            <div class="audit-section">
                <h3>‚ö†Ô∏è INCIDENT TRACKING</h3>
                <div class="audit-grid">
                    <div class="audit-metric">
                        <div class="audit-metric-label">Emergency Shutdowns</div>
                        <div class="audit-metric-value">${report.emergencies}</div>
                    </div>
                    <div class="audit-metric">
                        <div class="audit-metric-label">Scheduled Rests</div>
                        <div class="audit-metric-value">${report.scheduledRests}</div>
                    </div>
                    <div class="audit-metric">
                        <div class="audit-metric-label">Biological Damage</div>
                        <div class="audit-metric-value">${report.biologicalDamage} workers</div>
                    </div>
                    <div class="audit-metric">
                        <div class="audit-metric-label">Wall Status</div>
                        <div class="audit-metric-value">${report.wallBreachStatus}</div>
                    </div>
                </div>
            </div>

            <div class="audit-section">
                <h3>üîç FRICTION BREAKDOWN</h3>
                <div class="friction-breakdown">
                    <div class="friction-item">
                        <span>Scheduler Misalignment</span>
                        <span style="color: #00d9ff;">${report.frictionBreakdown.schedulerMisalignment.toFixed(1)}s</span>
                    </div>
                    <div class="friction-item">
                        <span>Emergency Overhead</span>
                        <span style="color: #ff9500;">${report.frictionBreakdown.emergencyOverhead.toFixed(1)}s</span>
                    </div>
                    <div class="friction-item">
                        <span>Capacity Degradation</span>
                        <span style="color: #ff0033;">${report.frictionBreakdown.capacityDegradation.toFixed(1)}s</span>
                    </div>
                </div>
            </div>

            <div class="audit-section">
                <h3>‚öñÔ∏è FORENSIC VERDICT</h3>
                <div class="verdict-badge ${verdictClass}">
                    ${report.verdict}: ${report.verdictCategory}
                </div>
                <div class="conclusion-box ${report.verdict === 'PASS' ? 'success' : ''}">
                    ${report.conclusion}
                </div>
            </div>

            <div class="audit-section">
                <h3>üìã BIOLOGICAL DAMAGE REGISTRY</h3>
                ${this.renderBiologicalDamageTable()}
            </div>
        `;
        
        modal.style.display = 'flex';
    }

    renderBiologicalDamageTable() {
        const damaged = FORENSICS.biologicallyDamagedWorkers;
        
        if (damaged.length === 0) {
            return '<div style="color: #00ff88;">‚úì No biological damage detected</div>';
        }
        
        return `
            <div class="friction-breakdown">
                <div class="friction-item" style="font-weight: bold; color: #00d9ff;">
                    <span>Worker ID</span>
                    <span>Breach Fatigue</span>
                    <span>Permanent Cap</span>
                    <span>Breach Time</span>
                </div>
                ${damaged.map(d => `
                    <div class="friction-item">
                        <span style="color: #ff0033;">${d.workerId}</span>
                        <span>${(d.breachFatigue * 100).toFixed(0)}%</span>
                        <span style="color: #ff9500;">${(d.maxCap * 100).toFixed(0)}%</span>
                        <span>${(d.timestamp / 60).toFixed(1)}m</span>
                    </div>
                `).join('')}
            </div>
        `;
    }
}

// Initialize app
const app = new EARAApp();
window.EARAApp = app;
window.CONFIG = CONFIG;
window.FORENSICS = FORENSICS;
    </script>
</body>
</html>
